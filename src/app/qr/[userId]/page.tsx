import generateQRCode, { QROptions } from '@/server/generateQRCode';
import { databaseClient } from '@/db/client';
import { users } from '@/db/schema/users';
import QRTicket from '@/app/components/QRTicket';

type QRPageProps = {
  params: { userId: string };
};

export default async function QRView({ params }: QRPageProps) {
  const { userId } = await params;
  const userList = await databaseClient.select().from(users);
  const pfp =
    'data:image/png;base64,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';
  const opts: QROptions = {
    margin: 1,
    scale: 10,
    color: {
      dark: '#FFFFFF',
      light: '#0000',
    },
  };
  const user = userList.find((user) => user.id === userId);
  const firstname = user ? user.first_name : null;
  const lastname = user ? user.last_name : null;

  const qrcode: string = await generateQRCode(userId, opts);
  return (
    <QRTicket
      pfp={pfp}
      firstname={firstname}
      lastname={lastname}
      qrcode={qrcode}
      role={'Hacker'}
      userId={userId}
    />
  );
}
